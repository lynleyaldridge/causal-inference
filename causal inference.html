<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Causal inference crib notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="causal inference_files/libs/clipboard/clipboard.min.js"></script>
<script src="causal inference_files/libs/quarto-html/quarto.js"></script>
<script src="causal inference_files/libs/quarto-html/popper.min.js"></script>
<script src="causal inference_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="causal inference_files/libs/quarto-html/anchor.min.js"></script>
<link href="causal inference_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="causal inference_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="causal inference_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="causal inference_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="causal inference_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="causal inference_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="causal inference_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#summary-table" id="toc-summary-table" class="nav-link" data-scroll-target="#summary-table">Summary table</a></li>
  <li><a href="#regression-recap" id="toc-regression-recap" class="nav-link" data-scroll-target="#regression-recap">Regression recap</a></li>
  <li><a href="#hisp-case-study" id="toc-hisp-case-study" class="nav-link" data-scroll-target="#hisp-case-study">HISP Case Study</a>
  <ul class="collapse">
  <li><a href="#introducing-the-hisp-evaluation-dataset" id="toc-introducing-the-hisp-evaluation-dataset" class="nav-link" data-scroll-target="#introducing-the-hisp-evaluation-dataset">Introducing the HISP evaluation dataset</a></li>
  </ul></li>
  <li><a href="#difference-in-differences" id="toc-difference-in-differences" class="nav-link" data-scroll-target="#difference-in-differences">Difference-in-differences</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#differences-in-differences-for-the-hisp-case-study" id="toc-differences-in-differences-for-the-hisp-case-study" class="nav-link" data-scroll-target="#differences-in-differences-for-the-hisp-case-study">Differences-in-differences for the HISP case study</a>
  <ul class="collapse">
  <li><a href="#two-way-comparison-of-means" id="toc-two-way-comparison-of-means" class="nav-link" data-scroll-target="#two-way-comparison-of-means">Two way comparison of means</a></li>
  <li><a href="#regression-models" id="toc-regression-models" class="nav-link" data-scroll-target="#regression-models">Regression models</a></li>
  <li><a href="#regression-output" id="toc-regression-output" class="nav-link" data-scroll-target="#regression-output">Regression output</a></li>
  <li><a href="#regression-equations" id="toc-regression-equations" class="nav-link" data-scroll-target="#regression-equations">Regression equations</a></li>
  </ul></li>
  <li><a href="#differences-in-differences-for-impact-of-social-security-survivor-benefits-on-college-attendance" id="toc-differences-in-differences-for-impact-of-social-security-survivor-benefits-on-college-attendance" class="nav-link" data-scroll-target="#differences-in-differences-for-impact-of-social-security-survivor-benefits-on-college-attendance">Differences-in-differences for impact of Social Security Survivor Benefits on college attendance</a>
  <ul class="collapse">
  <li><a href="#introducing-the-social-security-survivor-benefits-dataset" id="toc-introducing-the-social-security-survivor-benefits-dataset" class="nav-link" data-scroll-target="#introducing-the-social-security-survivor-benefits-dataset">Introducing the social security survivor benefits dataset</a></li>
  <li><a href="#survey-set-up-and-weighting" id="toc-survey-set-up-and-weighting" class="nav-link" data-scroll-target="#survey-set-up-and-weighting">Survey set up and weighting</a></li>
  <li><a href="#two-way-comparison-of-means-1" id="toc-two-way-comparison-of-means-1" class="nav-link" data-scroll-target="#two-way-comparison-of-means-1">Two way comparison of means</a></li>
  <li><a href="#regression-models-1" id="toc-regression-models-1" class="nav-link" data-scroll-target="#regression-models-1">Regression models</a></li>
  <li><a href="#regression-output-1" id="toc-regression-output-1" class="nav-link" data-scroll-target="#regression-output-1">Regression output</a></li>
  <li><a href="#regression-equation" id="toc-regression-equation" class="nav-link" data-scroll-target="#regression-equation">Regression equation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#matching" id="toc-matching" class="nav-link" data-scroll-target="#matching">Matching</a>
  <ul class="collapse">
  <li><a href="#warning" id="toc-warning" class="nav-link" data-scroll-target="#warning">Warning</a></li>
  <li><a href="#overview-1" id="toc-overview-1" class="nav-link" data-scroll-target="#overview-1">Overview</a>
  <ul class="collapse">
  <li><a href="#propensity-score-matching" id="toc-propensity-score-matching" class="nav-link" data-scroll-target="#propensity-score-matching">Propensity score matching</a></li>
  </ul></li>
  <li><a href="#propensity-score-matching-for-the-hisp-case-study" id="toc-propensity-score-matching-for-the-hisp-case-study" class="nav-link" data-scroll-target="#propensity-score-matching-for-the-hisp-case-study">Propensity score matching for the HISP case study</a>
  <ul class="collapse">
  <li><a href="#convert-dataset-to-wide-format" id="toc-convert-dataset-to-wide-format" class="nav-link" data-scroll-target="#convert-dataset-to-wide-format">Convert dataset to wide format</a></li>
  <li><a href="#estimate-propensity-scores-and-find-matches-with-the-matchit-function" id="toc-estimate-propensity-scores-and-find-matches-with-the-matchit-function" class="nav-link" data-scroll-target="#estimate-propensity-scores-and-find-matches-with-the-matchit-function">Estimate propensity scores and find matches with the matchit function</a></li>
  <li><a href="#summarize-estimates-of-propensity-scores-based-on-baseline-observed-characteristics" id="toc-summarize-estimates-of-propensity-scores-based-on-baseline-observed-characteristics" class="nav-link" data-scroll-target="#summarize-estimates-of-propensity-scores-based-on-baseline-observed-characteristics">Summarize estimates of propensity scores based on baseline observed characteristics</a></li>
  <li><a href="#is-there-common-support" id="toc-is-there-common-support" class="nav-link" data-scroll-target="#is-there-common-support">Is there common support?</a></li>
  <li><a href="#does-matching-by-propensity-score-improve-balance" id="toc-does-matching-by-propensity-score-improve-balance" class="nav-link" data-scroll-target="#does-matching-by-propensity-score-improve-balance">Does matching by propensity score improve balance?</a></li>
  <li><a href="#did-matching-by-propensity-score-improve-balance" id="toc-did-matching-by-propensity-score-improve-balance" class="nav-link" data-scroll-target="#did-matching-by-propensity-score-improve-balance">Did matching by propensity score improve balance?</a></li>
  <li><a href="#what-is-the-estimated-effect-of-the-program-using-the-matched-sample" id="toc-what-is-the-estimated-effect-of-the-program-using-the-matched-sample" class="nav-link" data-scroll-target="#what-is-the-estimated-effect-of-the-program-using-the-matched-sample">What is the estimated effect of the program, using the matched sample?</a></li>
  <li><a href="#what-is-the-estimated-effect-of-the-program-using-difference-in-differences-regression-combined-with-matching" id="toc-what-is-the-estimated-effect-of-the-program-using-difference-in-differences-regression-combined-with-matching" class="nav-link" data-scroll-target="#what-is-the-estimated-effect-of-the-program-using-difference-in-differences-regression-combined-with-matching">What is the estimated effect of the program, using difference-in-differences regression combined with matching?</a></li>
  </ul></li>
  <li><a href="#matching-approaches-for-analysis-of-impact-of-mosquito-nets-on-risk-of-malaria" id="toc-matching-approaches-for-analysis-of-impact-of-mosquito-nets-on-risk-of-malaria" class="nav-link" data-scroll-target="#matching-approaches-for-analysis-of-impact-of-mosquito-nets-on-risk-of-malaria">Matching approaches for analysis of impact of mosquito nets on risk of malaria</a>
  <ul class="collapse">
  <li><a href="#introducing-the-simulated-dataset-used-in-these-analyses" id="toc-introducing-the-simulated-dataset-used-in-these-analyses" class="nav-link" data-scroll-target="#introducing-the-simulated-dataset-used-in-these-analyses">Introducing the simulated dataset used in these analyses</a></li>
  <li><a href="#calculate-naive-causal-estimate" id="toc-calculate-naive-causal-estimate" class="nav-link" data-scroll-target="#calculate-naive-causal-estimate">Calculate naive causal estimate</a></li>
  <li><a href="#matching-1" id="toc-matching-1" class="nav-link" data-scroll-target="#matching-1">Matching</a></li>
  <li><a href="#inverse-probability-weighting" id="toc-inverse-probability-weighting" class="nav-link" data-scroll-target="#inverse-probability-weighting">Inverse probability weighting</a></li>
  <li><a href="#generate-propensity-scores" id="toc-generate-propensity-scores" class="nav-link" data-scroll-target="#generate-propensity-scores">Generate propensity scores</a></li>
  <li><a href="#find-effect" id="toc-find-effect" class="nav-link" data-scroll-target="#find-effect">Find effect</a></li>
  <li><a href="#comparing-models" id="toc-comparing-models" class="nav-link" data-scroll-target="#comparing-models">Comparing models</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#other-examples" id="toc-other-examples" class="nav-link" data-scroll-target="#other-examples">Other examples</a></li>
  <li><a href="#glossary" id="toc-glossary" class="nav-link" data-scroll-target="#glossary">Glossary</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a>
  <ul class="collapse">
  <li><a href="#textbooks" id="toc-textbooks" class="nav-link" data-scroll-target="#textbooks">Textbooks</a></li>
  <li><a href="#code-samples" id="toc-code-samples" class="nav-link" data-scroll-target="#code-samples">Code samples</a></li>
  <li><a href="#journal-articles" id="toc-journal-articles" class="nav-link" data-scroll-target="#journal-articles">Journal articles</a></li>
  <li><a href="#blog-posts" id="toc-blog-posts" class="nav-link" data-scroll-target="#blog-posts">Blog posts</a></li>
  <li><a href="#course-materials" id="toc-course-materials" class="nav-link" data-scroll-target="#course-materials">Course materials</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Causal inference crib notes</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="setup" class="level1">
<h1>Setup</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               here,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               haven, <span class="co"># for reading Stata .dta files</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>               sjPlot, <span class="co"># for viewing codebook and summarizing regression models</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>               srvyr, <span class="co"># for survey weighting and setup: can use with tidyverse</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>               survey, <span class="co"># for regression with survey data</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>               estimatr, <span class="co"># for regressions</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>               broom, <span class="co"># alternative for regressions</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>               modelsummary, <span class="co"># alternative for viewing model summaries</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>               MatchIt, <span class="co"># implements matching approaches</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>               kableExtra, <span class="co"># alternative to gt for tables</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>               gt) </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("datalorax/equatiomatic") </span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># for printing of regression equations</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(equatiomatic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This document consolidates my learning about techniques for casual inference in education in a single document, and includes a list of resources for further reading.</p>
</section>
<section id="summary-table" class="level1">
<h1>Summary table</h1>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 33%">
<col style="width: 23%">
<col style="width: 29%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>When to use?</th>
<th>Assumptions</th>
<th>Examples</th>
<th>xx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Randomized controlled experiment</td>
<td><p>We can randomly sample and assign individuals to treatment and control groups.</p>
<p>There are explicit program assignment rules.</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Difference-in-differences</td>
<td><p>Something “naturally” separates individuals into a treatment and control group - not separated based on a numerical cutoff.</p>
<p>Program assignment rules are not clear.</p></td>
<td><p>Parallel trends</p>
<p>There is no factor disproportionately impacting only one group at time of treatment</p></td>
<td><p>Spread of cholera in London between 1849 and 1854<span class="citation" data-cites="huntington-klein_effect_2021 cunningham_causal_2021"><sup><a href="#ref-huntington-klein_effect_2021" role="doc-biblioref">1</a>,<a href="#ref-cunningham_causal_2021" role="doc-biblioref">2</a></sup></span></p>
<p>CESE’s Connected Communities Strategy evaluation (with propensity score matching?)</p></td>
<td></td>
</tr>
<tr class="odd">
<td>Regression discontinuity</td>
<td><p>Something “naturally” separates individuals into a treatment and control group - separated based on some numerical cutoff.</p>
<p>There are explicit program assignment rules.</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Instrumental variables estimation</td>
<td>We have a background variable (not correlated by outcome) that can be used to predict participation</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Matching</td>
<td><p>We have data that can be used to match individuals in treatment and control conditions.</p>
<p>Program assignment rules are not clear.</p></td>
<td>No unobserved variables impacting program participation and outcomes</td>
<td><p>Mosquito nets and malaria risk (simulated data)<span class="citation" data-cites="heiss_program_nodate"><sup><a href="#ref-heiss_program_nodate" role="doc-biblioref">3</a></sup></span></p>
<p>National Supported Work Demonstration (NSW) job-training program<span class="citation" data-cites="cunningham_causal_2021"><sup><a href="#ref-cunningham_causal_2021" role="doc-biblioref">2</a></sup></span></p>
<p>Black politicians and response to out-of-area inquiries<span class="citation" data-cites="huntington-klein_effect_2021"><sup><a href="#ref-huntington-klein_effect_2021" role="doc-biblioref">1</a></sup></span></p>
<p>Public vs.&nbsp;Catholic math achievement<span class="citation" data-cites="murnane_methods_2010 ejdemyr_r_nodate"><sup><a href="#ref-murnane_methods_2010" role="doc-biblioref">4</a>,<a href="#ref-ejdemyr_r_nodate" role="doc-biblioref">5</a></sup></span></p>
<p>Schools to watch<span class="citation" data-cites="randolph_step-by-step_nodate"><sup><a href="#ref-randolph_step-by-step_nodate" role="doc-biblioref"><strong>randolph_step-by-step_nodate?</strong></a></sup></span></p>
<p>CESE’s COVID-ILSP Evaluation (Phase 3)</p>
<p>CESE’s ‘Why aren’t students studying higher level maths’ (contrasted with DiD)</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>Modified from : <a href="https://bookdown.org/aschmi11/causal_inf/" class="uri">https://bookdown.org/aschmi11/causal_inf/</a> (p.&nbsp;1)</p>
</section>
<section id="regression-recap" class="level1">
<h1>Regression recap</h1>
<p>Look at ‘Statistical Inference’</p>
</section>
<section id="hisp-case-study" class="level1">
<h1>HISP Case Study</h1>
<p>The case study presented in ‘Impact Evaluation in Practice’ relates to an evaluation of a health insurance subsidy program (HISP), intended to reduce out-of-pocket health-care costs for low-income households.</p>
<p>Data for this fictional case-study can be downloaded from the World Bank’s <a href="https://openknowledge.worldbank.org/entities/publication/ebbe3565-69ff-5fe2-b65d-11329cf45293">Open Knowledge Repository</a>. Select ‘Additional Material’ to download the zip folder ‘Impact evaluation in practice’. I saved the entire contents of this folder to the ‘iep’ subfolder of the ‘data’ folder within this project.</p>
<p>R code by Liam Beiser-McGrath can be downloaded from <a href="https://lfbeisermcgrath.github.io/rimpactevaluation/">Impact Evalutaion in Practice: Solutions for Second Edition in R</a>. Note that I also downloaded the file <a href="https://github.com/lfbeisermcgrath/rimpactevaluation/blob/master/data/variable_desc.csv">`variable_desc.csv’</a> from the github associated with this book</p>
<section id="introducing-the-hisp-evaluation-dataset" class="level2">
<h2 class="anchored" data-anchor-id="introducing-the-hisp-evaluation-dataset">Introducing the HISP evaluation dataset</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>HISP <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"iep"</span>, <span class="st">"evaluation.dta"</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">view_df</span>(HISP, <span class="at">show.type =</span> <span class="cn">TRUE</span>, <span class="at">show.frq =</span> <span class="cn">TRUE</span>, <span class="at">show.prc =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Data frame: HISP</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">ID</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Name</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Type</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Label</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Values</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Value Labels</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Freq.</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">%</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">locality_identifier</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Locality identifier</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 1-200</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">2</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">household_identifier</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Unique household identifier</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 2-15778</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">3</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">treatment_locality</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Household is located in treatment community (0=no,<br>
1=yes)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">4</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">promotion_locality</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Household is located in promoted community (0=no,<br>
1=yes)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">5</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">eligible</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Household eligible to enroll in HISP (0=no, 1=yes)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">6</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">enrolled</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">HH enrolled in HISP (0=no, 1=yes)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">7</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">enrolled_rp</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Household enrolled in HISP under the random<br>
promotion scenario (0=no, 1=yes)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">8</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">poverty_index</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Poverty Index 1-100</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 20.5-100.0</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">9</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">round</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Survey round (0 = baseline; 1 = follow-up)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">10</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">health_expenditures</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Out of pocket health expenditures (per person per<br>
year)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 0.0-116.8</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">11</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">age_hh</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Age of the head of the household (in years)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 14.0-88.0</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">12</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">age_sp</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Age of the spouse (in years)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 14-88</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">13</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">educ_hh</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Education of the head of household (completed<br>
years of schooling)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 0.0-16.0</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">14</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">educ_sp</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Education of the spouse (completed years of<br>
schooling)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 0.0-17.0</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">15</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">female_hh</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Head of the household is a woman (0=no, 1=yes)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">16</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">indigenous</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Head of household speaks an indigenous language<br>
(0=no, 1=yes)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">17</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">hhsize</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Number of household members (baseline)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 1-13</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">18</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">dirtfloor</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Home has a dirt floor at baseline (0=no, 1=yes)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">19</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">bathroom</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Home with private bathroom at baseline (0=no,<br>
1=yes)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">20</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">land</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Number of hectares of land owned by household at<br>
baseline</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 0-23</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">21</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">hospital_distance</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Distance to closest hospital</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 9.5-170.5</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">22</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">hospital</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">HH member visited hospital in the past year (0=no,<br>
1=yes)</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="difference-in-differences" class="level1">
<h1>Difference-in-differences</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Resources on difference-in-differences
</div>
</div>
<div class="callout-body-container callout-body">
<p>For overviews and worked examples of the difference-in-differences approach, see:</p>
<p>Chapter 7, <a href="https://www.worldbank.org/en/programs/sief-trust-fund/publication/impact-evaluation-in-practice">Impact evaluation in practice</a> (Paul Gertler et al, 2016)</p>
<p>Chapter 8, Methods Matter (Murnane &amp; Willett, 2010)</p>
<p>Chapter 4, <a href="https://bookdown.org/aschmi11/causal_inf/">Causal inference in education</a> (Anthony Schmidt, 2020)</p>
<p>Weeks 8 and 9, <a href="https://evalsp24.classes.andrewheiss.com/content/08-content.html">Andrew Heiss’s Program Evaluation module</a></p>
<p>Chapter 18, <a href="https://theeffectbook.net/">The Effect</a> (Nick Huntington-Klein, 2021)</p>
<p>Chapter 9, <a href="https://mixtape.scunning.com/">Causal inference: The Mixtape</a> (Scott Cunningham, 2021)</p>
</div>
</div>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>The difference-in-differences approach compares <em>changes</em> in outcomes over time between a population receiving treatment and a population not receiving treatment<span class="citation" data-cites="gertler_impact_2016"><sup><a href="#ref-gertler_impact_2016" role="doc-biblioref">6</a></sup></span>. This removes the time-varying differences assumed to be constant between groups and cancels out the effect of <em>observed</em> and <em>unobserved</em> time-invariant characteristics of individuals.</p>
<p>Difference-in-differences approaches assume <em>parallel trends</em> between the treatment and control group: “treatment and control groups evolve similarly in the absence of treatment, even if from different starting points”<span class="citation" data-cites="marginal_revolution_university_introduction_2021"><sup><a href="#ref-marginal_revolution_university_introduction_2021" role="doc-biblioref">7</a></sup></span>.</p>
<p>We can test this by:</p>
<ul>
<li><p>comparing repeatedly before implementation</p></li>
<li><p>including a fake treatment group, for whom we expect to find zero impact (e.g., grade level not exposed to the treatment, nor being used as comparison group)</p></li>
<li><p>calculating estimates for a fake outcome, for which we expect to find zero impact (e.g., number of siblings)</p></li>
<li><p>using multiple comparison groups (for whom estimated impact should be approximately the same)</p></li>
<li><p><span class="citation" data-cites="gertler_impact_2016"><sup><a href="#ref-gertler_impact_2016" role="doc-biblioref">6</a></sup></span></p></li>
</ul>
<p>I have a bumper sticker on my car that says “I love Federalism (for the natural experiments)”<span class="citation" data-cites="cunningham_causal_2021"><sup><a href="#ref-cunningham_causal_2021" role="doc-biblioref">2</a></sup></span></p>
</section>
<section id="differences-in-differences-for-the-hisp-case-study" class="level2">
<h2 class="anchored" data-anchor-id="differences-in-differences-for-the-hisp-case-study">Differences-in-differences for the HISP case study</h2>
<section id="two-way-comparison-of-means" class="level3">
<h3 class="anchored" data-anchor-id="two-way-comparison-of-means">Two way comparison of means</h3>
<p><a href="#tbl-comparison-means-HISP">Table&nbsp;1</a> presents mean household health expenditures (in dollars) for enrolled and nonenrolled households, before and after the introduction of HISP.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>HISP <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treatment_locality <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">round =</span> <span class="fu">case_when</span>(round <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"after"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                           round <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"before"</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">enrolled =</span> <span class="fu">case_when</span>(enrolled <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Nonenrolled"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                              enrolled <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Enrolled"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(enrolled, round) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">average =</span> <span class="fu">mean</span>(health_expenditures)) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> round,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> average) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">difference =</span> <span class="fu">as.character</span>(<span class="fu">round</span>(before <span class="sc">-</span> after, <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">enrolled =</span> <span class="st">"Difference"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">after =</span> <span class="sc">-</span><span class="fl">6.30</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">before =</span> <span class="sc">-</span><span class="fl">14.46</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">difference =</span> <span class="st">"DD = -6.65 - 1.51 = -8.16 &lt;br&gt; DD = -6.30 - -14.46 = -8.16"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"enrolled"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="at">after =</span> <span class="st">"After (follow-up)"</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">before =</span> <span class="st">"Before (baseline)"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">difference =</span> <span class="st">"Difference"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_align</span>(<span class="at">align =</span> <span class="st">"right"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">columns =</span> difference) <span class="sc">%&gt;%</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">decimals =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>(<span class="at">missing_text =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_markdown</span>(<span class="at">columns=</span> difference)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-comparison-means-HISP" class="anchored">

<div id="vrojqcjdhf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#vrojqcjdhf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#vrojqcjdhf thead, #vrojqcjdhf tbody, #vrojqcjdhf tfoot, #vrojqcjdhf tr, #vrojqcjdhf td, #vrojqcjdhf th {
  border-style: none;
}

#vrojqcjdhf p {
  margin: 0;
  padding: 0;
}

#vrojqcjdhf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vrojqcjdhf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vrojqcjdhf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vrojqcjdhf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vrojqcjdhf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vrojqcjdhf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vrojqcjdhf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vrojqcjdhf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vrojqcjdhf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vrojqcjdhf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vrojqcjdhf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vrojqcjdhf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vrojqcjdhf .gt_spanner_row {
  border-bottom-style: hidden;
}

#vrojqcjdhf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vrojqcjdhf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vrojqcjdhf .gt_from_md > :first-child {
  margin-top: 0;
}

#vrojqcjdhf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vrojqcjdhf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vrojqcjdhf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vrojqcjdhf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vrojqcjdhf .gt_row_group_first td {
  border-top-width: 2px;
}

#vrojqcjdhf .gt_row_group_first th {
  border-top-width: 2px;
}

#vrojqcjdhf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vrojqcjdhf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vrojqcjdhf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vrojqcjdhf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vrojqcjdhf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vrojqcjdhf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vrojqcjdhf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#vrojqcjdhf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vrojqcjdhf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vrojqcjdhf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vrojqcjdhf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vrojqcjdhf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vrojqcjdhf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vrojqcjdhf .gt_left {
  text-align: left;
}

#vrojqcjdhf .gt_center {
  text-align: center;
}

#vrojqcjdhf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vrojqcjdhf .gt_font_normal {
  font-weight: normal;
}

#vrojqcjdhf .gt_font_bold {
  font-weight: bold;
}

#vrojqcjdhf .gt_font_italic {
  font-style: italic;
}

#vrojqcjdhf .gt_super {
  font-size: 65%;
}

#vrojqcjdhf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#vrojqcjdhf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vrojqcjdhf .gt_indent_1 {
  text-indent: 5px;
}

#vrojqcjdhf .gt_indent_2 {
  text-indent: 10px;
}

#vrojqcjdhf .gt_indent_3 {
  text-indent: 15px;
}

#vrojqcjdhf .gt_indent_4 {
  text-indent: 20px;
}

#vrojqcjdhf .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false"><caption>Table&nbsp;1:  <p>Evaluating HISP: Difference-in-differences comparison of means [Table
7.2 in Gertler et al. (2016)]</p> </caption>
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="After (follow-up)">After (follow-up)</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Before (baseline)">Before (baseline)</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Difference">Difference</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><th id="stub_1_1" scope="row" class="gt_row gt_left gt_stub">Enrolled</th>
<td headers="stub_1_1 after" class="gt_row gt_right">14.49</td>
<td headers="stub_1_1 before" class="gt_row gt_right">7.84</td>
<td headers="stub_1_1 difference" class="gt_row gt_right"><div data-qmd="-6.65"><div class="gt_from_md"><p>-6.65</p>
</div></div></td></tr>
    <tr><th id="stub_1_2" scope="row" class="gt_row gt_left gt_stub">Nonenrolled</th>
<td headers="stub_1_2 after" class="gt_row gt_right">20.79</td>
<td headers="stub_1_2 before" class="gt_row gt_right">22.30</td>
<td headers="stub_1_2 difference" class="gt_row gt_right"><div data-qmd="1.51"><div class="gt_from_md"><p>1.51</p>
</div></div></td></tr>
    <tr><th id="stub_1_3" scope="row" class="gt_row gt_left gt_stub">Difference</th>
<td headers="stub_1_3 after" class="gt_row gt_right">−6.30</td>
<td headers="stub_1_3 before" class="gt_row gt_right">−14.46</td>
<td headers="stub_1_3 difference" class="gt_row gt_right"><div data-qmd="DD = -6.65 - 1.51 = -8.16 <br> DD = -6.30 - -14.46 = -8.16"><div class="gt_from_md"><p>DD = -6.65 - 1.51 = -8.16 <br> DD = -6.30 - -14.46 = -8.16</p>
</div></div></td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
</section>
<section id="regression-models" class="level3">
<h3 class="anchored" data-anchor-id="regression-models">Regression models</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that Liam's code uses estimatr::lm_robust (to generate clustered standard errors, which appears necessary with clustered data), which we continue to do below, but equatiomatic can't be used with object of class lm_robust</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># &lt;https://evalf21.classes.andrewheiss.com/example/standard-errors/&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>out_did <span class="ot">&lt;-</span> estimatr<span class="sc">::</span><span class="fu">lm_robust</span>(health_expenditures <span class="sc">~</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                                 round <span class="sc">*</span> enrolled,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> HISP <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                       treatment_locality <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">clusters =</span> locality_identifier)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>out_did_wcov <span class="ot">&lt;-</span> estimatr<span class="sc">::</span><span class="fu">lm_robust</span>(health_expenditures <span class="sc">~</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                            round <span class="sc">*</span> enrolled <span class="sc">+</span> age_hh <span class="sc">+</span> age_sp <span class="sc">+</span> educ_hh <span class="sc">+</span> educ_sp <span class="sc">+</span> female_hh <span class="sc">+</span> indigenous <span class="sc">+</span> hhsize <span class="sc">+</span> dirtfloor <span class="sc">+</span> bathroom <span class="sc">+</span> land <span class="sc">+</span> hospital_distance,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> HISP <span class="sc">%&gt;%</span> <span class="fu">filter</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                       treatment_locality <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">clusters =</span> locality_identifier</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                          )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="regression-output" class="level3">
<h3 class="anchored" data-anchor-id="regression-output">Regression output</h3>
<p>In <a href="#tbl-comparison-models-HISP">Table&nbsp;2</a>, we use <a href="https://cran.r-project.org/web/packages/sjPlot/vignettes/tab_model_estimates.html">sjPlot::tab_model</a> to summarize the outputs of both regressions, side-by-side. Note that sjPlot works well with labelled data (i.e., we started with a stata data file with variable labels assigned, and imported this using haven::read_dta). Also note that html is the only output format (not PDF).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">tab_model</span>(out_did, out_did_wcov,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show.intercept =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"enrolled"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"round"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"round:enrolled"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-comparison-models-HISP" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;2: Test</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Out of pocket health<br>
expenditures(per person<br>
per year)</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Out of pocket health<br>
expenditures(per person<br>
per year)</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">20.79</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">20.45&nbsp;–&nbsp;21.13</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">27.39</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">26.29&nbsp;–&nbsp;28.50</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Survey<br>
round(0=baseline;1=follow-up)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.51</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.81&nbsp;–&nbsp;2.22</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.45</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.75&nbsp;–&nbsp;2.15</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">HH enrolled in<br>
HISP(0=no,1=yes)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-6.30</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-6.68&nbsp;–&nbsp;-5.92</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-1.51</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-1.77&nbsp;–&nbsp;-1.26</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">round:enrolled</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-8.16</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-8.79&nbsp;–&nbsp;-7.53</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-8.16</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-8.79&nbsp;–&nbsp;-7.53</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">9919</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">9919</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.344 / 0.343</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.552 / 0.551</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>From this, we could tentatively conclude:</p>
<ul>
<li><p>Being enrolled in the program was associated with a $6.3 decrease in health expenditures ($1.51 when adjusted for covariates)”</p></li>
<li><p>Health expenditures at follow-up were $1.51 increased from baseline ($1.45 when adjusted for coveriates)</p></li>
<li><p>The program reduced health expenditures for those enrolled by $8.16</p></li>
</ul>
<p>This assumes, however:</p>
<ul>
<li><p>Groups would have evolved similarly in the absence of treatment (even if starting points were different)</p></li>
<li><p>There were no other factors that disproportionately impacted only one group at the time of treatment</p></li>
</ul>
</section>
<section id="regression-equations" class="level3">
<h3 class="anchored" data-anchor-id="regression-equations">Regression equations</h3>
<p>The first model is of the form shown in <a href="#eq-out-did">Equation&nbsp;1</a></p>
<p><span id="eq-out-did"><span class="math display">\[
health expenditure = 20.79 + 1.51 \times round - 6.30 \times enrolled - 8.16 \times round:enrolled
\tag{1}\]</span></span></p>
<p>The second model is of the form shown in <a href="#eq-out-did-wcov">Equation&nbsp;2</a></p>
<p><span id="eq-out-did-wcov"><span class="math display">\[
health expenditure = 27.39 + 1.45 \times round - 1.51 \times enrolled - 8.16 \times round:enrolled (and a string of adjustments for covariates)
\tag{2}\]</span></span></p>
</section>
</section>
<section id="differences-in-differences-for-impact-of-social-security-survivor-benefits-on-college-attendance" class="level2">
<h2 class="anchored" data-anchor-id="differences-in-differences-for-impact-of-social-security-survivor-benefits-on-college-attendance">Differences-in-differences for impact of Social Security Survivor Benefits on college attendance</h2>
<p>Murnane and Willett (2010)<span class="citation" data-cites="murnane_methods_2010"><sup><a href="#ref-murnane_methods_2010" role="doc-biblioref">4</a></sup></span> provide a case study looking at college attendance before and after 1981, when financial aid for college stopped being provided to children of deceased fathers. (See<span class="citation" data-cites="dynarski_does_2003"><sup><a href="#ref-dynarski_does_2003" role="doc-biblioref">8</a></sup></span> for original analysis.)</p>
<p>Data for case studies in this book can be downloaded from UCLA’s <a href="https://stats.oarc.ucla.edu/other/examples/methods-matter/">Statistical Methods and Data Analytics</a> website. I saved the entire contents of this folder to the ‘methods_matter’ subfolder of the ‘data’ folder within this project.</p>
<p>See also: <a href="https://stats.oarc.ucla.edu/stata/examples/methods-matter/chapter8/" class="uri">https://stats.oarc.ucla.edu/stata/examples/methods-matter/chapter8/</a></p>
<section id="introducing-the-social-security-survivor-benefits-dataset" class="level3">
<h3 class="anchored" data-anchor-id="introducing-the-social-security-survivor-benefits-dataset">Introducing the social security survivor benefits dataset</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sssb <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"methods_matter"</span>, <span class="st">"ch8_dynarski.dta"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fatherdec =</span> <span class="fu">as_factor</span>(fatherdec))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">view_df</span>(sssb, <span class="at">show.type =</span> <span class="cn">TRUE</span>, <span class="at">show.frq =</span> <span class="cn">TRUE</span>, <span class="at">show.prc =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Data frame: sssb</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">ID</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Name</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Type</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Label</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Values</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Value Labels</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Freq.</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">%</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">id</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">identification code (1-12686) 7</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 9-12558</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">2</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">hhid</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">hh identification number 79</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 9-12558</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">3</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">wt88</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">sampling weight 88</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 39739-1064870</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">4</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">coll</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Full-time college by age 23</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">5</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">hgc23</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Highest grade completed by age 23</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 10-19</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">6</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">yearsr</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Year in which a senior</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 79-83</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">7</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">fatherdec</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">categorical</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Father deceased by age 18</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Father not deceased<br>
Father deceased</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">3795<br>
191</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">95.21<br>
4.79</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">8</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">offer</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">Senior in year SSSB support available</td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="survey-set-up-and-weighting" class="level3">
<h3 class="anchored" data-anchor-id="survey-set-up-and-weighting">Survey set up and weighting</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># survey set up and weighting</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>srvy_data <span class="ot">&lt;-</span> sssb <span class="sc">%&gt;%</span> srvyr<span class="sc">::</span><span class="fu">as_survey_design</span>(<span class="at">ids =</span> hhid, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">weights =</span> wt88)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="two-way-comparison-of-means-1" class="level3">
<h3 class="anchored" data-anchor-id="two-way-comparison-of-means-1">Two way comparison of means</h3>
<p><a href="#tbl-comparison-means-SSSB">Table&nbsp;3</a> presents mean college enrollments by the age of 23, for those receiving or not receiving social security benefits, before and after changes to eligibility for offers of support. (Note that receipt of social security benefits was determined based on whether young people’s fathrs had died before their 18th birthday.)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>srvy_data <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">offer =</span> <span class="fu">case_when</span>(offer <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"no"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                           offer <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"yes"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(offer, fatherdec) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  srvyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">average =</span> srvyr<span class="sc">::</span><span class="fu">survey_mean</span>(coll)) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>(average_se)) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> offer,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> average) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(fatherdec)) <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fatherdec, yes, no) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">difference =</span> <span class="fu">as.character</span>(<span class="fu">round</span>(yes <span class="sc">-</span> no, <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">fatherdec =</span> <span class="st">"Difference"</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">yes =</span> <span class="fl">0.06</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">no =</span> <span class="sc">-</span><span class="fl">0.13</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">difference =</span> <span class="st">"DD = .21 - .03 = .18 &lt;br&gt; DD = .06 - -.13 = .19"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"fatherdec"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="at">no =</span> <span class="st">"SSSB support not available"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">yes =</span> <span class="st">"SSSB support available"</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">difference =</span> <span class="st">"Difference"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_align</span>(<span class="at">align =</span> <span class="st">"right"</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">columns =</span> difference) <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">decimals =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>(<span class="at">missing_text =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_markdown</span>(<span class="at">columns=</span> difference)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-comparison-means-SSSB" class="anchored">

<div id="mgdlnahyen" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mgdlnahyen table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mgdlnahyen thead, #mgdlnahyen tbody, #mgdlnahyen tfoot, #mgdlnahyen tr, #mgdlnahyen td, #mgdlnahyen th {
  border-style: none;
}

#mgdlnahyen p {
  margin: 0;
  padding: 0;
}

#mgdlnahyen .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mgdlnahyen .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mgdlnahyen .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mgdlnahyen .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mgdlnahyen .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mgdlnahyen .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mgdlnahyen .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mgdlnahyen .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mgdlnahyen .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mgdlnahyen .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mgdlnahyen .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mgdlnahyen .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mgdlnahyen .gt_spanner_row {
  border-bottom-style: hidden;
}

#mgdlnahyen .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mgdlnahyen .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mgdlnahyen .gt_from_md > :first-child {
  margin-top: 0;
}

#mgdlnahyen .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mgdlnahyen .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mgdlnahyen .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mgdlnahyen .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mgdlnahyen .gt_row_group_first td {
  border-top-width: 2px;
}

#mgdlnahyen .gt_row_group_first th {
  border-top-width: 2px;
}

#mgdlnahyen .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mgdlnahyen .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mgdlnahyen .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mgdlnahyen .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mgdlnahyen .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mgdlnahyen .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mgdlnahyen .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mgdlnahyen .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mgdlnahyen .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mgdlnahyen .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mgdlnahyen .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mgdlnahyen .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mgdlnahyen .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mgdlnahyen .gt_left {
  text-align: left;
}

#mgdlnahyen .gt_center {
  text-align: center;
}

#mgdlnahyen .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mgdlnahyen .gt_font_normal {
  font-weight: normal;
}

#mgdlnahyen .gt_font_bold {
  font-weight: bold;
}

#mgdlnahyen .gt_font_italic {
  font-style: italic;
}

#mgdlnahyen .gt_super {
  font-size: 65%;
}

#mgdlnahyen .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mgdlnahyen .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mgdlnahyen .gt_indent_1 {
  text-indent: 5px;
}

#mgdlnahyen .gt_indent_2 {
  text-indent: 10px;
}

#mgdlnahyen .gt_indent_3 {
  text-indent: 15px;
}

#mgdlnahyen .gt_indent_4 {
  text-indent: 20px;
}

#mgdlnahyen .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false"><caption>Table&nbsp;3:  <p>Evaluating SSSB: Difference-in-differences comparison of means</p> </caption>
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="SSSB support available">SSSB support available</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="SSSB support not available">SSSB support not available</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Difference">Difference</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><th id="stub_1_1" scope="row" class="gt_row gt_left gt_stub">Father deceased</th>
<td headers="stub_1_1 yes" class="gt_row gt_right">0.56</td>
<td headers="stub_1_1 no" class="gt_row gt_right">0.35</td>
<td headers="stub_1_1 difference" class="gt_row gt_right"><div data-qmd="0.21"><div class="gt_from_md"><p>0.21</p>
</div></div></td></tr>
    <tr><th id="stub_1_2" scope="row" class="gt_row gt_left gt_stub">Father not deceased</th>
<td headers="stub_1_2 yes" class="gt_row gt_right">0.50</td>
<td headers="stub_1_2 no" class="gt_row gt_right">0.48</td>
<td headers="stub_1_2 difference" class="gt_row gt_right"><div data-qmd="0.03"><div class="gt_from_md"><p>0.03</p>
</div></div></td></tr>
    <tr><th id="stub_1_3" scope="row" class="gt_row gt_left gt_stub">Difference</th>
<td headers="stub_1_3 yes" class="gt_row gt_right">0.06</td>
<td headers="stub_1_3 no" class="gt_row gt_right">−0.13</td>
<td headers="stub_1_3 difference" class="gt_row gt_right"><div data-qmd="DD = .21 - .03 = .18 <br> DD = .06 - -.13 = .19"><div class="gt_from_md"><p>DD = .21 - .03 = .18 <br> DD = .06 - -.13 = .19</p>
</div></div></td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</div>
</section>
<section id="regression-models-1" class="level3">
<h3 class="anchored" data-anchor-id="regression-models-1">Regression models</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>srvy_did <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svyglm</span>(coll <span class="sc">~</span> offer <span class="sc">+</span> fatherdec <span class="sc">+</span> offer<span class="sc">*</span>fatherdec,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> srvy_data,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">design =</span> srvy_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="regression-output-1" class="level3">
<h3 class="anchored" data-anchor-id="regression-output-1">Regression output</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">tab_model</span>(srvy_did)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Full-time college by age<br>
23</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.48</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.44&nbsp;–&nbsp;0.51</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Senior in year SSSB<br>
support available</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.03</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.02&nbsp;–&nbsp;0.07</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.221</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Father deceased by age<br>
18: Father deceased</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.12</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.29&nbsp;–&nbsp;0.04</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.139</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">offer:fatherdecFather deceased</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.18</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.01&nbsp;–&nbsp;0.37</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.057</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">3986</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.002 / -0.275</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The interaction term <em>offer x father deceased</em> is the difference-in-differences estimate, indicating that for those eligible for support (i.e., those with deceased fathers), enrollment percentages were 18 percentage points higher during the period in which support was provided than afterwards.</p>
</section>
<section id="regression-equation" class="level3">
<h3 class="anchored" data-anchor-id="regression-equation">Regression equation</h3>
<p>Testing label for <strong>?@eq-srvy-did</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>equatiomatic<span class="sc">::</span><span class="fu">extract_eq</span>(srvy_did, <span class="at">use_coefs =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><span class="math display">\[
\widehat{E( \operatorname{coll} )} = 0.48 + 0.03(\operatorname{offer}) - 0.12(\operatorname{fatherdec}_{\operatorname{Father\ deceased}}) + 0.18(\operatorname{offer} \times \operatorname{fatherdec}_{\operatorname{Father\ deceased}})
\]</span></p>
</div>
</div>
</section>
</section>
</section>
<section id="matching" class="level1">
<h1>Matching</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Resources on matching
</div>
</div>
<div class="callout-body-container callout-body">
<p>For overviews and worked examples of matching approaches, see:</p>
<p>Chapter 8, <a href="https://www.worldbank.org/en/programs/sief-trust-fund/publication/impact-evaluation-in-practice">Impact evaluation in practice</a> (Paul Gertler et al, 2016)</p>
<p>Chapter 7, <a href="https://bookdown.org/aschmi11/causal_inf/">Causal inference in education</a> (Anthony Schmidt, 2020)</p>
<p>Week 7, <a href="https://evalsp24.classes.andrewheiss.com/content/07-content.html">Andrew Heiss’s Program Evaluation module</a> - and <a href="https://evalsp24.classes.andrewheiss.com/example/matching-ipw.html">worked example of Matching and IPW</a></p>
<p>Chapter 13, <a href="https://theeffectbook.net/">The Effect</a> (Nick Huntington-Klein, 2021)</p>
<p>Chapter 5, <a href="https://mixtape.scunning.com/">Causal inference: The Mixtape</a> (Scott Cunningham, 2021)</p>
<p>Chapter 12, Methods Matter (Murnane &amp; Willett, 2010)</p>
</div>
</div>
<section id="warning" class="level2">
<h2 class="anchored" data-anchor-id="warning">Warning</h2>
<p>Note Gary King and Richard Nielsen<span class="citation" data-cites="king_why_2019 methods_colloquium_gary_2015"><sup><a href="#ref-king_why_2019" role="doc-biblioref">9</a>,<a href="#ref-methods_colloquium_gary_2015" role="doc-biblioref">10</a></sup></span> talk about how we shouldn’t use propensity scores for <em>matching for identification purposes</em> (i.e., when trying to isolate the relationship between x and y, and remove the confounding).<span class="citation" data-cites="andrew_heiss_pmap_2020 huntington-klein_effect_2021"><sup><a href="#ref-huntington-klein_effect_2021" role="doc-biblioref">1</a>,See also <a href="#ref-andrew_heiss_pmap_2020" role="doc-biblioref">11</a></sup></span>. Note that they are fine to use in other contexts (e.g., for inverse probability weighting), but consider reworking the examples below with nearest neighbor or Mahalanobus distance.</p>
</section>
<section id="overview-1" class="level2">
<h2 class="anchored" data-anchor-id="overview-1">Overview</h2>
<p>Matching approaches to causal inference calculate the estimated impact of a program by comparing the average difference in outcomes between those receiving the treatment and a statistically matched group of controls.<span class="citation" data-cites="gertler_impact_2016"><sup><a href="#ref-gertler_impact_2016" role="doc-biblioref">6</a></sup></span>.</p>
<p><em>A lack of common support</em> refers to the situation where the distributions of variables used to match treatment and control observations do not sufficiently overlap.<span class="citation" data-cites="gertler_impact_2016 huntington-klein_effect_2021"><sup><a href="#ref-huntington-klein_effect_2021" role="doc-biblioref">1</a>,<a href="#ref-gertler_impact_2016" role="doc-biblioref">6</a></sup></span>. In this situation, we might restrict the sample and estimate the <em>Local Average Treatment Effect</em> “for observations with common support in the distribution of propensity scores.</p>
<p>Only (1) observed characteristics (2) measured at baseline can be used for matching, and (3) results are limited by the characteristics used for matching. It is most important to match on the basis of characteristics that impact whether units receive treatment or not.</p>
<p>Note also that if baseline data on outcomes are available, the matching method should be combined with difference-in-differences. This further reduces bias by accounting for any time-invariant unobserved characteristics. In this case:</p>
<ol type="1">
<li>match on observed baseline characteristics</li>
<li>calculate individual changes in outcomes before and after treatment for treated group</li>
<li>calculate individual changes in outcomes over time for matched comparison units</li>
<li>subtract 3) from 2)</li>
<li>average the double differences</li>
</ol>
<section id="propensity-score-matching" class="level3">
<h3 class="anchored" data-anchor-id="propensity-score-matching">Propensity score matching</h3>
<p>Propensity score matching computes the probability of enrollment in the program at baseline (based on observed characteristics) of those receiving and not receiving treatment, and matches units in the treatment group with non-treated units whose propensity scores are the closest<span class="citation" data-cites="gertler_impact_2016"><sup><a href="#ref-gertler_impact_2016" role="doc-biblioref">6</a></sup></span>.</p>
</section>
</section>
<section id="propensity-score-matching-for-the-hisp-case-study" class="level2">
<h2 class="anchored" data-anchor-id="propensity-score-matching-for-the-hisp-case-study">Propensity score matching for the HISP case study</h2>
<section id="convert-dataset-to-wide-format" class="level3">
<h3 class="anchored" data-anchor-id="convert-dataset-to-wide-format">Convert dataset to wide format</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>HISP_wide <span class="ot">&lt;-</span> HISP <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> round,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(health_expenditures,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                              poverty_index,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                              age_hh,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                              age_sp,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                              educ_hh,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                              educ_sp,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                              female_hh,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                              indigenous,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                              hhsize,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                              dirtfloor,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                              bathroom,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                              land,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                              hospital_distance,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                              hospital)) <span class="sc">%&gt;%</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove household with missing values for health expenciture at baseline</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(health_expenditures_0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="estimate-propensity-scores-and-find-matches-with-the-matchit-function" class="level3">
<h3 class="anchored" data-anchor-id="estimate-propensity-scores-and-find-matches-with-the-matchit-function">Estimate propensity scores and find matches with the matchit function</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate propensity scores using only age_hh and educ_hh at baseline</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># psm_r = propensity score matches using restricted model</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>psm_r <span class="ot">&lt;-</span> <span class="fu">matchit</span>(enrolled <span class="sc">~</span> age_hh_0 <span class="sc">+</span> educ_hh_0,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> HISP_wide <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                   dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>hospital_0, <span class="sc">-</span>hospital_1),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distance =</span> <span class="st">"glm"</span>, <span class="at">link =</span> <span class="st">"probit"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>psm_ur <span class="ot">&lt;-</span> <span class="fu">matchit</span>(enrolled <span class="sc">~</span> age_hh_0 <span class="sc">+</span> educ_hh_0 <span class="sc">+</span> age_sp_0 <span class="sc">+</span> educ_sp_0 <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                    female_hh_0 <span class="sc">+</span> indigenous_0 <span class="sc">+</span> hhsize_0 <span class="sc">+</span> dirtfloor_0 <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                    bathroom_0 <span class="sc">+</span> land_0 <span class="sc">+</span> hospital_distance_0,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> HISP_wide <span class="sc">%&gt;%</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                   dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>hospital_0, <span class="sc">-</span>hospital_1), </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">distance =</span> <span class="st">"glm"</span>, <span class="at">link =</span> <span class="st">"probit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summarize-estimates-of-propensity-scores-based-on-baseline-observed-characteristics" class="level3">
<h3 class="anchored" data-anchor-id="summarize-estimates-of-propensity-scores-based-on-baseline-observed-characteristics">Summarize estimates of propensity scores based on baseline observed characteristics</h3>
<p><a href="#tbl-propensity-score-estimates-HISP">Table&nbsp;4</a> presents two models for calculating propensity scores, one with a limited set of explanatory variables and one with a full set. This table suggests households are less likely to be involved in the program if the head of the household is older, more educated, or female. Households with a bathroom, or owning larger amounts of land are also less likely to be enrolled. Households are more likely to be enrolled if they are indigenous, larger, have a dirt floor, or are located further from the hospital. This suggests the program has been successful in enrolling target poorer households.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">tab_model</span>(psm_r<span class="sc">$</span>model, psm_ur<span class="sc">$</span>model,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">transform =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dv.labels =</span> <span class="fu">c</span>(<span class="st">"Limited set of explanatory variables"</span>, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Full set of explanatory variables"</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-propensity-score-estimates-HISP" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;4: Estimating the propensity score based on baseline observed characteristics [Table 8.1 in Gertler et al. (2016)]</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Limited set of explanatory variables</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Full set of explanatory variables</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Log-Odds</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Log-Odds</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.554</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.440&nbsp;–&nbsp;0.668</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.497</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.674&nbsp;–&nbsp;-0.321</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Age of the head of the<br>
household(in years)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.021</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.023&nbsp;–&nbsp;-0.019</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.013</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.017&nbsp;–&nbsp;-0.010</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Education of the head of<br>
household(completed years<br>
of schooling)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.041</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.052&nbsp;–&nbsp;-0.030</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.022</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.034&nbsp;–&nbsp;-0.009</td>
<td style="text-align: center;"><strong>0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Age of the spouse(in<br>
years)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.008</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.012&nbsp;–&nbsp;-0.004</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Education of the<br>
spouse(completed years of<br>
schooling)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.016</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.029&nbsp;–&nbsp;-0.002</td>
<td style="text-align: center;"><strong>0.020</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Head of the household is<br>
a woman(0=no,1=yes)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.020</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.122&nbsp;–&nbsp;0.080</td>
<td style="text-align: center;">0.691</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Head of household speaks<br>
an indigenous<br>
language(0=no,1=yes)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.161</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.101&nbsp;–&nbsp;0.222</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Number of household<br>
members(baseline)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.119</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.106&nbsp;–&nbsp;0.132</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Home has a dirt floor at<br>
baseline(0=no,1=yes)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.376</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.316&nbsp;–&nbsp;0.436</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Home with private<br>
bathroom at<br>
baseline(0=no,1=yes)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.125</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.181&nbsp;–&nbsp;-0.068</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Number of hectares of<br>
land owned by household<br>
at baseline</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.028</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.038&nbsp;–&nbsp;-0.018</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Distance to closest<br>
hospital</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.002</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.001&nbsp;–&nbsp;0.002</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">9913</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">9913</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> Nagelkerke</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.062</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.147</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Note: Probit regression. The dependent variable is 1 if the household enrolled in HISP, and 0 otherwise. The coefficients represent the contribution of each listed explanatory variable to the probability that a household enrolled in HISP.</p>
</section>
<section id="is-there-common-support" class="level3">
<h3 class="anchored" data-anchor-id="is-there-common-support">Is there common support?</h3>
<p><a href="#fig-common-support-HISP">Figure&nbsp;1</a> presents</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add propensity scores from model to dataframe</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>HISP_wide <span class="ot">&lt;-</span> HISP_wide <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ps_ur =</span> psm_ur<span class="sc">$</span>model<span class="sc">$</span>fitted.values)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>HISP_wide <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">enrolled_lab =</span> <span class="fu">ifelse</span>(enrolled <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Enrolled"</span>, <span class="st">"Not Enrolled"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ps_ur,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">group =</span> enrolled_lab,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> enrolled_lab,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> enrolled_lab)) <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fu">I</span>(<span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Propensity Score"</span>) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="st">"Status:"</span>, <span class="at">end =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>(<span class="st">"Status:"</span>, <span class="at">end =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-common-support-HISP" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="causal-inference_files/figure-html/fig-common-support-HISP-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Matching for HISP: Common Support [Figure 8.3 in Gertler et al.&nbsp;(2016)]</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="does-matching-by-propensity-score-improve-balance" class="level3">
<h3 class="anchored" data-anchor-id="does-matching-by-propensity-score-improve-balance">Does matching by propensity score improve balance?</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># according to package documentation to test this we</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. constructing a pre-match matchit object</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>m.out0 <span class="ot">&lt;-</span> <span class="fu">matchit</span>(enrolled <span class="sc">~</span> age_hh_0 <span class="sc">+</span> educ_hh_0 <span class="sc">+</span> age_sp_0 <span class="sc">+</span> educ_sp_0 <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                    female_hh_0 <span class="sc">+</span> indigenous_0 <span class="sc">+</span> hhsize_0 <span class="sc">+</span> dirtfloor_0 <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                    bathroom_0 <span class="sc">+</span> land_0 <span class="sc">+</span> hospital_distance_0,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> HISP_wide <span class="sc">%&gt;%</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>hospital_0, <span class="sc">-</span>hospital_1),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="cn">NULL</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">distance =</span> <span class="st">"glm"</span>, <span class="at">link =</span> <span class="st">"probit"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. summarize this object</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.out0) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
matchit(formula = enrolled ~ age_hh_0 + educ_hh_0 + age_sp_0 + 
    educ_sp_0 + female_hh_0 + indigenous_0 + hhsize_0 + dirtfloor_0 + 
    bathroom_0 + land_0 + hospital_distance_0, data = HISP_wide %&gt;% 
    dplyr::select(-hospital_0, -hospital_1), method = NULL, distance = "glm", 
    link = "probit")

Summary of Balance for All Data:
                    Means Treated Means Control Std. Mean Diff. Var. Ratio
distance                   0.3694        0.2684          0.7781     0.8190
age_hh_0                  41.6566       48.1384         -0.4731     0.7798
educ_hh_0                  2.9712        2.7745          0.0743     0.8960
age_sp_0                  36.8364       41.6117         -0.4098     0.8042
educ_sp_0                  2.7033        2.5810          0.0494     0.9257
female_hh_0                0.0732        0.1101         -0.1416          .
indigenous_0               0.4291        0.3203          0.2199          .
hhsize_0                   5.7699        4.9263          0.4226     0.8030
dirtfloor_0                0.7217        0.5533          0.3756          .
bathroom_0                 0.5735        0.6340         -0.1223          .
land_0                     1.6771        2.2511         -0.2172     0.6391
hospital_distance_0      109.2043      103.6626          0.1324     0.9917
                    eCDF Mean eCDF Max
distance               0.2003   0.3119
age_hh_0               0.0881   0.2074
educ_hh_0              0.0218   0.0623
age_sp_0               0.0648   0.2100
educ_sp_0              0.0141   0.0690
female_hh_0            0.0369   0.0369
indigenous_0           0.1088   0.1088
hhsize_0               0.0652   0.1833
dirtfloor_0            0.1683   0.1683
bathroom_0             0.0605   0.0605
land_0                 0.0241   0.0882
hospital_distance_0    0.0396   0.0830

Sample Sizes:
          Control Treated
All          6949    2964
Matched      6949    2964
Unmatched       0       0
Discarded       0       0</code></pre>
</div>
</div>
<p>From the [MatchIt documentation](<a href="https://cran.r-project.org/web/packages/MatchIt/vignettes/MatchIt.html" class="uri">https://cran.r-project.org/web/packages/MatchIt/vignettes/MatchIt.html</a>), we have good balance if standardized mean differences and eCDF statistics are close to zero, and variance ratios ar close to one</p>
</section>
<section id="did-matching-by-propensity-score-improve-balance" class="level3">
<h3 class="anchored" data-anchor-id="did-matching-by-propensity-score-improve-balance">Did matching by propensity score improve balance?</h3>
<p>Before matching</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">summary</span>(psm_ur)<span class="sc">$</span>sum.all,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Balance Before Matching"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Balance Before Matching</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Means Treated</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Means Control</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std. Mean Diff.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Var. Ratio</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">eCDF Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">eCDF Max</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std. Pair Dist.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">distance</td>
<td style="text-align: right;">0.3694119</td>
<td style="text-align: right;">0.2683525</td>
<td style="text-align: right;">0.7780852</td>
<td style="text-align: right;">0.8189848</td>
<td style="text-align: right;">0.2003240</td>
<td style="text-align: right;">0.3118783</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_hh_0</td>
<td style="text-align: right;">41.6565796</td>
<td style="text-align: right;">48.1384372</td>
<td style="text-align: right;">-0.4731180</td>
<td style="text-align: right;">0.7797904</td>
<td style="text-align: right;">0.0881294</td>
<td style="text-align: right;">0.2074113</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">educ_hh_0</td>
<td style="text-align: right;">2.9711803</td>
<td style="text-align: right;">2.7744736</td>
<td style="text-align: right;">0.0742925</td>
<td style="text-align: right;">0.8959873</td>
<td style="text-align: right;">0.0218441</td>
<td style="text-align: right;">0.0622731</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_sp_0</td>
<td style="text-align: right;">36.8363698</td>
<td style="text-align: right;">41.6117427</td>
<td style="text-align: right;">-0.4098452</td>
<td style="text-align: right;">0.8042407</td>
<td style="text-align: right;">0.0647834</td>
<td style="text-align: right;">0.2100395</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">educ_sp_0</td>
<td style="text-align: right;">2.7032726</td>
<td style="text-align: right;">2.5810189</td>
<td style="text-align: right;">0.0494165</td>
<td style="text-align: right;">0.9256881</td>
<td style="text-align: right;">0.0141252</td>
<td style="text-align: right;">0.0689847</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">female_hh_0</td>
<td style="text-align: right;">0.0732119</td>
<td style="text-align: right;">0.1100878</td>
<td style="text-align: right;">-0.1415669</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0368759</td>
<td style="text-align: right;">0.0368759</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">indigenous_0</td>
<td style="text-align: right;">0.4291498</td>
<td style="text-align: right;">0.3203339</td>
<td style="text-align: right;">0.2198503</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.1088159</td>
<td style="text-align: right;">0.1088159</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">hhsize_0</td>
<td style="text-align: right;">5.7699055</td>
<td style="text-align: right;">4.9263203</td>
<td style="text-align: right;">0.4225943</td>
<td style="text-align: right;">0.8029708</td>
<td style="text-align: right;">0.0651539</td>
<td style="text-align: right;">0.1833283</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dirtfloor_0</td>
<td style="text-align: right;">0.7216599</td>
<td style="text-align: right;">0.5533170</td>
<td style="text-align: right;">0.3756130</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.1683429</td>
<td style="text-align: right;">0.1683429</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">bathroom_0</td>
<td style="text-align: right;">0.5735493</td>
<td style="text-align: right;">0.6340481</td>
<td style="text-align: right;">-0.1223283</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0604988</td>
<td style="text-align: right;">0.0604988</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">land_0</td>
<td style="text-align: right;">1.6771255</td>
<td style="text-align: right;">2.2511153</td>
<td style="text-align: right;">-0.2172044</td>
<td style="text-align: right;">0.6390513</td>
<td style="text-align: right;">0.0240692</td>
<td style="text-align: right;">0.0881821</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">hospital_distance_0</td>
<td style="text-align: right;">109.2043122</td>
<td style="text-align: right;">103.6626222</td>
<td style="text-align: right;">0.1323667</td>
<td style="text-align: right;">0.9916816</td>
<td style="text-align: right;">0.0395806</td>
<td style="text-align: right;">0.0829805</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>After matching</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">summary</span>(psm_ur)<span class="sc">$</span>sum.matched,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Balance After Matching"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Balance After Matching</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Means Treated</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Means Control</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std. Mean Diff.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Var. Ratio</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">eCDF Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">eCDF Max</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std. Pair Dist.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">distance</td>
<td style="text-align: right;">0.3694119</td>
<td style="text-align: right;">0.3687162</td>
<td style="text-align: right;">0.0053561</td>
<td style="text-align: right;">1.0138523</td>
<td style="text-align: right;">0.0007394</td>
<td style="text-align: right;">0.0084345</td>
<td style="text-align: right;">0.0055861</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_hh_0</td>
<td style="text-align: right;">41.6565796</td>
<td style="text-align: right;">41.7867746</td>
<td style="text-align: right;">-0.0095031</td>
<td style="text-align: right;">1.0867281</td>
<td style="text-align: right;">0.0114843</td>
<td style="text-align: right;">0.0381242</td>
<td style="text-align: right;">0.9086975</td>
</tr>
<tr class="odd">
<td style="text-align: left;">educ_hh_0</td>
<td style="text-align: right;">2.9711803</td>
<td style="text-align: right;">2.9549320</td>
<td style="text-align: right;">0.0061367</td>
<td style="text-align: right;">0.9271782</td>
<td style="text-align: right;">0.0094467</td>
<td style="text-align: right;">0.0239541</td>
<td style="text-align: right;">1.0892771</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_sp_0</td>
<td style="text-align: right;">36.8363698</td>
<td style="text-align: right;">36.9915655</td>
<td style="text-align: right;">-0.0133196</td>
<td style="text-align: right;">1.1143952</td>
<td style="text-align: right;">0.0104041</td>
<td style="text-align: right;">0.0371120</td>
<td style="text-align: right;">0.9332429</td>
</tr>
<tr class="odd">
<td style="text-align: left;">educ_sp_0</td>
<td style="text-align: right;">2.7032726</td>
<td style="text-align: right;">2.7128880</td>
<td style="text-align: right;">-0.0038867</td>
<td style="text-align: right;">0.8918377</td>
<td style="text-align: right;">0.0072981</td>
<td style="text-align: right;">0.0215924</td>
<td style="text-align: right;">1.0663763</td>
</tr>
<tr class="even">
<td style="text-align: left;">female_hh_0</td>
<td style="text-align: right;">0.0732119</td>
<td style="text-align: right;">0.0732119</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.1288799</td>
</tr>
<tr class="odd">
<td style="text-align: left;">indigenous_0</td>
<td style="text-align: right;">0.4291498</td>
<td style="text-align: right;">0.4234143</td>
<td style="text-align: right;">0.0115879</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0057355</td>
<td style="text-align: right;">0.0057355</td>
<td style="text-align: right;">0.9031755</td>
</tr>
<tr class="even">
<td style="text-align: left;">hhsize_0</td>
<td style="text-align: right;">5.7699055</td>
<td style="text-align: right;">5.7884615</td>
<td style="text-align: right;">-0.0092956</td>
<td style="text-align: right;">0.8691665</td>
<td style="text-align: right;">0.0105626</td>
<td style="text-align: right;">0.0229420</td>
<td style="text-align: right;">0.9946331</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dirtfloor_0</td>
<td style="text-align: right;">0.7216599</td>
<td style="text-align: right;">0.7253711</td>
<td style="text-align: right;">-0.0082806</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0037112</td>
<td style="text-align: right;">0.0037112</td>
<td style="text-align: right;">0.6857819</td>
</tr>
<tr class="even">
<td style="text-align: left;">bathroom_0</td>
<td style="text-align: right;">0.5735493</td>
<td style="text-align: right;">0.5732119</td>
<td style="text-align: right;">0.0006822</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">0.0003374</td>
<td style="text-align: right;">0.0003374</td>
<td style="text-align: right;">0.9816638</td>
</tr>
<tr class="odd">
<td style="text-align: left;">land_0</td>
<td style="text-align: right;">1.6771255</td>
<td style="text-align: right;">1.7010796</td>
<td style="text-align: right;">-0.0090645</td>
<td style="text-align: right;">1.0159498</td>
<td style="text-align: right;">0.0045968</td>
<td style="text-align: right;">0.0276653</td>
<td style="text-align: right;">0.8103167</td>
</tr>
<tr class="even">
<td style="text-align: left;">hospital_distance_0</td>
<td style="text-align: right;">109.2043122</td>
<td style="text-align: right;">108.5100383</td>
<td style="text-align: right;">0.0165832</td>
<td style="text-align: right;">0.9993878</td>
<td style="text-align: right;">0.0104486</td>
<td style="text-align: right;">0.0485830</td>
<td style="text-align: right;">1.0886493</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>We can also plot the improvements in balance achieved by matching as in Figure xx.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">summary</span>(psm_ur))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="causal-inference_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="what-is-the-estimated-effect-of-the-program-using-the-matched-sample" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-estimated-effect-of-the-program-using-the-matched-sample">What is the estimated effect of the program, using the matched sample?</h3>
<p>Here my answers do not match those in the solutions</p>
<p>Textbook Table 8.3: full set, -9.95; limited set -11.35 (linear regression)</p>
<p>Liam:</p>
<p>full set, intercept 19.73 and enrolled of -11.89 (I do not match)</p>
<p>limited set intercept 17.84 and enrolled -10.00 (I match)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first extract matched data set</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>HISP_match_df_r <span class="ot">&lt;-</span> <span class="fu">match.data</span>(psm_r)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>HISP_match_df_ur <span class="ot">&lt;-</span> <span class="fu">match.data</span>(psm_ur)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># next, estimate program effect using (weighted) linear regression</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># as all weights here equal 1, no need to use weights </span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># (one-to-one matching without replacement)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>out_lm_r <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(health_expenditures_1 <span class="sc">~</span> enrolled,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> HISP_match_df_r, <span class="at">clusters =</span> locality_identifier,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weights =</span> weights)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>out_lm_ur <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(health_expenditures_1 <span class="sc">~</span> enrolled,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> HISP_match_df_ur, <span class="at">clusters =</span> locality_identifier,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weights =</span> weights)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># finally, summarize results of regression models</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">tab_model</span>(out_lm_r, out_lm_ur,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dv.labels =</span> <span class="fu">c</span>(<span class="st">"Limited set of explanatory variables"</span>, </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Full set of explanatory variables"</span>),</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Limited set of explanatory variables</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Full set of explanatory variables</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">18.960</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">18.364&nbsp;–&nbsp;19.556</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">17.840</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">17.280&nbsp;–&nbsp;18.401</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">HH enrolled in<br>
HISP(0=no,1=yes)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-11.120</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-11.883&nbsp;–&nbsp;-10.357</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-10.001</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-10.724&nbsp;–&nbsp;-9.277</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">5928</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">5928</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.300 / 0.300</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.280 / 0.280</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="what-is-the-estimated-effect-of-the-program-using-difference-in-differences-regression-combined-with-matching" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-estimated-effect-of-the-program-using-difference-in-differences-regression-combined-with-matching">What is the estimated effect of the program, using difference-in-differences regression combined with matching?</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, merge matched data and original data, removing unmatched observations</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># limited set of explanatory variables</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>HISP_long_match_r <span class="ot">&lt;-</span>  HISP <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(HISP_match_df_r <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(household_identifier, weights)) <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weights))</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># full set of explanatory variables</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>HISP_long_match_ur <span class="ot">&lt;-</span>  HISP <span class="sc">%&gt;%</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(HISP_match_df_ur <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(household_identifier, weights)) <span class="sc">%&gt;%</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weights))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># next, conduct difference_in-differences regressions</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>did_reg_r <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(health_expenditures <span class="sc">~</span> enrolled <span class="sc">*</span> round,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> HISP_long_match_r, <span class="at">weights =</span> weights,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters =</span> locality_identifier)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>did_reg_ur <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(health_expenditures <span class="sc">~</span> enrolled <span class="sc">*</span> round,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> HISP_long_match_ur, <span class="at">weights =</span> weights,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">clusters =</span> locality_identifier)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># finally, summarize results of regression models</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">tab_model</span>(did_reg_r, did_reg_ur,</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dv.labels =</span> <span class="fu">c</span>(<span class="st">"Limited set of explanatory variables"</span>, </span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Full set of explanatory variables"</span>),</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Limited set of explanatory variables</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Full set of explanatory variables</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">15.888</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">15.484&nbsp;–&nbsp;16.293</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">15.034</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">14.683&nbsp;–&nbsp;15.386</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">HH enrolled in<br>
HISP(0=no,1=yes)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-1.399</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-1.900&nbsp;–&nbsp;-0.897</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.545</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-1.009&nbsp;–&nbsp;-0.080</td>
<td style="text-align: center;"><strong>0.022</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">Survey<br>
round(0=baseline;1=follow-up)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">3.072</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">2.611&nbsp;–&nbsp;3.533</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">2.806</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">2.362&nbsp;–&nbsp;3.250</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">enrolled:round</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-9.722</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-10.325&nbsp;–&nbsp;-9.118</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-9.456</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-10.039&nbsp;–&nbsp;-8.872</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">11856</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">11856</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.260 / 0.260</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.240 / 0.240</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="matching-approaches-for-analysis-of-impact-of-mosquito-nets-on-risk-of-malaria" class="level2">
<h2 class="anchored" data-anchor-id="matching-approaches-for-analysis-of-impact-of-mosquito-nets-on-risk-of-malaria">Matching approaches for analysis of impact of mosquito nets on risk of malaria</h2>
<p>This exercise uses a simulated dataset created by Andrew Heiss, into which he has built a true average treatment effect (ATE) of -10. In other words, we should be concluding from our analysis that using a mosquito net <em>causes</em> the risk of malaria to decrease by a average 10 percentage points.</p>
<p>Here, I walk through step-by-step analyses included in his tutorial to cement my own understanding of the material.</p>
<p>First, download the data from Andrew’s tutorial, <a href="https://evalsp24.classes.andrewheiss.com/example/matching-ipw.html">Matching and inverse probability weighting</a>. I saved this in a subfolder named “heiss” in the “data” folder.</p>
<section id="introducing-the-simulated-dataset-used-in-these-analyses" class="level3">
<h3 class="anchored" data-anchor-id="introducing-the-simulated-dataset-used-in-these-analyses">Introducing the simulated dataset used in these analyses</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>nets <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"heiss"</span>, <span class="st">"mosquito_nets.csv"</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">view_df</span>(nets, <span class="at">show.type =</span> <span class="cn">TRUE</span>, <span class="at">show.frq =</span> <span class="cn">TRUE</span>, <span class="at">show.prc =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Data frame: nets</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">ID</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Name</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Type</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Label</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Values</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Value Labels</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">Freq.</td>
<td data-quarto-table-cell-role="th" style="text-align: left; border-bottom: double; font-style: italic; font-weight: normal; padding: 0.2cm; vertical-align: top;">%</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">id</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 1-1752</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">2</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">net</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">lgl</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">3</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">net_num</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 0-1</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">4</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">malaria_risk</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 10-90</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">5</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">income</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 301-1469</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">6</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">health</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 5-100</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">7</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">household</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 1-9</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">8</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">eligible</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">lgl</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">9</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">temperature</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top;"><em>range: 15.6-32.2</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">10</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">resistance</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;">numeric</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td colspan="2" style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"><em>range: 5-95</em></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top; background-color: #eeeeee;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="calculate-naive-causal-estimate" class="level3">
<h3 class="anchored" data-anchor-id="calculate-naive-causal-estimate">Calculate naive causal estimate</h3>
<p>Andrew begins by calculating the association between mosquito net usage and average malaria risk. On average, mosquito net usage is associated with a 16.3 point reduction in the risk of an individual in the household contracting malaria. But this analysis does not take into account potential differences in income, temperature and health that may also be associated with the use of mosquito nets.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>model_wrong <span class="ot">&lt;-</span> <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net, <span class="at">data =</span> nets)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(model_wrong,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">show.se =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="4" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">malaria risk</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">std. Error</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">41.94</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.40</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">41.14&nbsp;–&nbsp;42.73</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">netTRUE</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-16.33</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.65</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-17.61&nbsp;–&nbsp;-15.06</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">1752</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="4" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.265 / 0.265</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="matching-1" class="level3">
<h3 class="anchored" data-anchor-id="matching-1">Matching</h3>
<section id="step-1---preprocessing" class="level4">
<h4 class="anchored" data-anchor-id="step-1---preprocessing">Step 1 - Preprocessing</h4>
<p>Matching techniques pair up observations with similar values in confounding variables (income, temperature and health), assuming that within observations with similar values on these variables, the choice of whether or not to use the net was random. Here we use `matchit()’ to match observations based on Mahalanobis distance. We create a new trimmed dataset for subsequent analyses, which trims data to only observations for which matches were available.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>nets_matched_data <span class="ot">&lt;-</span> <span class="fu">matchit</span>(net <span class="sc">~</span> income <span class="sc">+</span> temperature <span class="sc">+</span> health,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> nets,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">method =</span> <span class="st">"nearest"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">distance =</span> <span class="st">"mahalanobis"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="co"># one-to-many possibilities </span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>nets_matched_data_trimmed <span class="ot">&lt;-</span> <span class="fu">match.data</span>(nets_matched_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-2---estimating" class="level4">
<h4 class="anchored" data-anchor-id="step-2---estimating">Step 2 - Estimating</h4>
<p>Running a regression model on the trimmed and matched dataset allows us to estimate the impact of mosquito net usage on malaria risk, using only the matched dataset. We can look at diagnostics to see how successful our matching has been, and/or we can use weights calculated by `matchit()’ to scale back the overcounting of observations that have been matched multiple times.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>model_matched <span class="ot">&lt;-</span> <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> nets_matched_data_trimmed)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>model_matched_weights <span class="ot">&lt;-</span> <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> nets_matched_data_trimmed,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">weights =</span> weights)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(model_matched, model_matched_weights,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">dv.labels =</span> <span class="fu">c</span>(<span class="st">"Matched data"</span>, </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"Matched data and weights"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Matched data</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">Matched data and weights</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">38.33</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">37.16&nbsp;–&nbsp;39.51</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">36.09</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">34.92&nbsp;–&nbsp;37.26</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">netTRUE</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-12.73</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-14.24&nbsp;–&nbsp;-11.22</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-10.48</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-11.98&nbsp;–&nbsp;-8.98</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">1117</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">1117</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.198 / 0.197</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.144 / 0.144</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="inverse-probability-weighting" class="level3">
<h3 class="anchored" data-anchor-id="inverse-probability-weighting">Inverse probability weighting</h3>
<p>An alternative approach to matching is to calculate the probability of receiving treatment for each observation, and then weight each observation by the inverse of this probability. This means that observations that received treatment despite having a low probability of treatment, and observations that did not receive treatment despite having a high probability of treatment, will be given more weight in estimating the effect. The advantage here is that we are not throwing away unmatched observations.</p>
</section>
<section id="generate-propensity-scores" class="level3">
<h3 class="anchored" data-anchor-id="generate-propensity-scores">Generate propensity scores</h3>
<p>First, we calculate propensity scores (here using a logistic regression), predicting use of mosquito nets based on income, temperatures and health. We then use augment_columns to add the predicted values to our dataset. and calculate the inverse of these scores as in the formula below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>model_net <span class="ot">&lt;-</span> <span class="fu">glm</span>(net <span class="sc">~</span> income <span class="sc">+</span> temperature <span class="sc">+</span> health,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> nets,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(model_net)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">net</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Odds Ratios</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.27</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.13&nbsp;–&nbsp;0.56</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">income</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.00</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.00&nbsp;–&nbsp;1.00</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">temperature</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.94</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.92&nbsp;–&nbsp;0.97</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">health</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.01</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.00&nbsp;–&nbsp;1.02</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.109</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">1752</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> Tjur</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.061</td>
</tr>
</tbody>
</table>


</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>nets_ipw <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment_columns</span>(model_net,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                                   nets,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                                   </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="co"># to use probability score from 0-1</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">type.predict =</span> <span class="st">"response"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">propensity =</span> .fitted) <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ipw =</span> (net_num <span class="sc">/</span> propensity) <span class="sc">+</span> ((<span class="dv">1</span> <span class="sc">-</span> net_num) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> propensity)))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># augment will throw away columns not used in model</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># augment_columns adds to columns already in database</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># .fitted is predicted probability</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ipw can be understood as 'weirdness score'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="find-effect" class="level3">
<h3 class="anchored" data-anchor-id="find-effect">Find effect</h3>
<p>Next, we estimate the effect of the treatment as usual (here using a linear regression), applying the inverse propensity weights as weights.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model_ipw <span class="ot">&lt;-</span> <span class="fu">lm</span>(malaria_risk <span class="sc">~</span> net,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> nets_ipw,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">weights =</span> ipw)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(model_ipw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">malaria risk</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">39.68</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">38.76&nbsp;–&nbsp;40.60</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">netTRUE</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-10.13</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-11.42&nbsp;–&nbsp;-8.84</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">1752</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.119 / 0.119</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="comparing-models" class="level3">
<h3 class="anchored" data-anchor-id="comparing-models">Comparing models</h3>
<p>Finally, we compare the estimated effect of all models explored in this tutorial.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">tab_model</span>(model_wrong,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>          model_matched,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>          model_matched_weights,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>          model_ipw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">malaria risk</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">malaria risk</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">malaria risk</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">malaria risk</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center;">p</td>
<td style="text-align: center;">Estimates</td>
<td style="text-align: center;">CI</td>
<td style="text-align: center;">p</td>
<td style="text-align: center;">Estimates</td>
<td style="text-align: center;">CI</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">41.94</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">41.14&nbsp;–&nbsp;42.73</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">38.33</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">37.16&nbsp;–&nbsp;39.51</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
<td style="text-align: center;">36.09</td>
<td style="text-align: center;">34.92&nbsp;–&nbsp;37.26</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
<td style="text-align: center;">39.68</td>
<td style="text-align: center;">38.76&nbsp;–&nbsp;40.60</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">netTRUE</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-16.33</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-17.61&nbsp;–&nbsp;-15.06</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-12.73</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-14.24&nbsp;–&nbsp;-11.22</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
<td style="text-align: center;">-10.48</td>
<td style="text-align: center;">-11.98&nbsp;–&nbsp;-8.98</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
<td style="text-align: center;">-10.13</td>
<td style="text-align: center;">-11.42&nbsp;–&nbsp;-8.84</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">1752</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">1117</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">1117</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">1752</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.265 / 0.265</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.198 / 0.197</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.144 / 0.144</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.119 / 0.119</td>
</tr>
</tbody>
</table>


</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Naive"</span> <span class="ot">=</span> model_wrong,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Matched"</span> <span class="ot">=</span> model_matched,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Matched with weights"</span> <span class="ot">=</span> model_matched_weights,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Inverse probability weights"</span> <span class="ot">=</span> model_ipw))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

 

  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tinytable_duz960wrkxf4jzg3cmea</title>
    <style>
.table td.tinytable_css_x670gqotbevpkdw938xz, .table th.tinytable_css_x670gqotbevpkdw938xz {    border-bottom: solid 0.1em #d3d8dc; }
.table td.tinytable_css_l7wiadc7ju7w0lf7y6jv, .table th.tinytable_css_l7wiadc7ju7w0lf7y6jv {    text-align: left; }
.table td.tinytable_css_q9ddafe6bwc6np3rferf, .table th.tinytable_css_q9ddafe6bwc6np3rferf {    text-align: center; }
.table td.tinytable_css_krio400gxdz9xc9cb45r, .table th.tinytable_css_krio400gxdz9xc9cb45r {    text-align: center; }
.table td.tinytable_css_o8wn2e27hyvfgmykk3vz, .table th.tinytable_css_o8wn2e27hyvfgmykk3vz {    text-align: center; }
.table td.tinytable_css_mwux6kc2lfoujm06l69n, .table th.tinytable_css_mwux6kc2lfoujm06l69n {    text-align: center; }
.table td.tinytable_css_28erlizoeskdvzy6su0e, .table th.tinytable_css_28erlizoeskdvzy6su0e {    border-bottom: solid 0.05em black; }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
  

  
    <div class="container">
      <table class="table table-borderless" id="tinytable_duz960wrkxf4jzg3cmea" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Naive</th>
                <th scope="col">Matched</th>
                <th scope="col">Matched with weights</th>
                <th scope="col">Inverse probability weights</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>(Intercept)</td>
                  <td>41.937   </td>
                  <td>38.335   </td>
                  <td>36.090   </td>
                  <td>39.679   </td>
                </tr>
                <tr>
                  <td>           </td>
                  <td>(0.405)  </td>
                  <td>(0.599)  </td>
                  <td>(0.597)  </td>
                  <td>(0.468)  </td>
                </tr>
                <tr>
                  <td>netTRUE    </td>
                  <td>-16.332  </td>
                  <td>-12.730  </td>
                  <td>-10.485  </td>
                  <td>-10.131  </td>
                </tr>
                <tr>
                  <td>           </td>
                  <td>(0.649)  </td>
                  <td>(0.768)  </td>
                  <td>(0.765)  </td>
                  <td>(0.658)  </td>
                </tr>
                <tr>
                  <td>Num.Obs.   </td>
                  <td>1752     </td>
                  <td>1117     </td>
                  <td>1117     </td>
                  <td>1752     </td>
                </tr>
                <tr>
                  <td>R2         </td>
                  <td>0.265    </td>
                  <td>0.198    </td>
                  <td>0.144    </td>
                  <td>0.119    </td>
                </tr>
                <tr>
                  <td>R2 Adj.    </td>
                  <td>0.265    </td>
                  <td>0.197    </td>
                  <td>0.144    </td>
                  <td>0.119    </td>
                </tr>
                <tr>
                  <td>AIC        </td>
                  <td>14030.7  </td>
                  <td>8819.3   </td>
                  <td>8866.0   </td>
                  <td>14274.3  </td>
                </tr>
                <tr>
                  <td>BIC        </td>
                  <td>14047.1  </td>
                  <td>8834.3   </td>
                  <td>8881.1   </td>
                  <td>14290.7  </td>
                </tr>
                <tr>
                  <td>Log.Lik.   </td>
                  <td>-7012.326</td>
                  <td>-4406.637</td>
                  <td>-4430.020</td>
                  <td>-7134.172</td>
                </tr>
                <tr>
                  <td>RMSE       </td>
                  <td>13.24    </td>
                  <td>12.50    </td>
                  <td>12.58    </td>
                  <td>13.59    </td>
                </tr>
        </tbody>
      </table>
    </div>

    <script>
      function styleCell_tinytable_i680elbhn1v97b0ysx8z(i, j, css_id) {
        var table = document.getElementById("tinytable_duz960wrkxf4jzg3cmea");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_duz960wrkxf4jzg3cmea');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_tinytable_i680elbhn1v97b0ysx8z(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_duz960wrkxf4jzg3cmea");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }

window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(0, 0, 'tinytable_css_x670gqotbevpkdw938xz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(0, 1, 'tinytable_css_x670gqotbevpkdw938xz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(0, 2, 'tinytable_css_x670gqotbevpkdw938xz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(0, 3, 'tinytable_css_x670gqotbevpkdw938xz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(0, 4, 'tinytable_css_x670gqotbevpkdw938xz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(0, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(1, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(2, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(3, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(4, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(5, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(6, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(7, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(8, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(9, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(10, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(11, 0, 'tinytable_css_l7wiadc7ju7w0lf7y6jv') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(0, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(1, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(2, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(3, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(4, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(5, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(6, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(7, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(8, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(9, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(10, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(11, 1, 'tinytable_css_q9ddafe6bwc6np3rferf') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(0, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(1, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(2, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(3, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(4, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(5, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(6, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(7, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(8, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(9, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(10, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(11, 2, 'tinytable_css_krio400gxdz9xc9cb45r') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(0, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(1, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(2, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(3, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(4, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(5, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(6, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(7, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(8, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(9, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(10, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(11, 3, 'tinytable_css_o8wn2e27hyvfgmykk3vz') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(0, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(1, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(2, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(3, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(4, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(5, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(6, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(7, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(8, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(9, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(10, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(11, 4, 'tinytable_css_mwux6kc2lfoujm06l69n') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(4, 0, 'tinytable_css_28erlizoeskdvzy6su0e') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(4, 1, 'tinytable_css_28erlizoeskdvzy6su0e') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(4, 2, 'tinytable_css_28erlizoeskdvzy6su0e') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(4, 3, 'tinytable_css_28erlizoeskdvzy6su0e') })
window.addEventListener('load', function () { styleCell_tinytable_i680elbhn1v97b0ysx8z(4, 4, 'tinytable_css_28erlizoeskdvzy6su0e') })
    </script>

  


</div>
</div>
</section>
</section>
</section>
<section id="other-examples" class="level1">
<h1>Other examples</h1>
<ul>
<li><p>Controlling for the schools where students apply and are accepted found that, all other things being equal, private school graduates did not earn more than public school graduates: Stacy Dale and Alan Krueger<span class="citation" data-cites="marginal_revolution_university_selection_2019"><sup><a href="#ref-marginal_revolution_university_selection_2019" role="doc-biblioref">12</a></sup></span></p></li>
<li><p>Measuring the effect of ‘tight’ and ‘easy’ monetary policies in response to the collapse of Caldwell &amp; Company in the South in 1930 (different Federal reserve districts)</p></li>
</ul>
</section>
<section id="glossary" class="level1">
<h1>Glossary</h1>
<p>Ceteris Paribus - “all other things being equal” (perfectly balanced comparison)<span class="citation" data-cites="marginal_revolution_university_ceteris_2019 marginal_revolution_university_selection_2019"><sup><a href="#ref-marginal_revolution_university_selection_2019" role="doc-biblioref">12</a>,<a href="#ref-marginal_revolution_university_ceteris_2019" role="doc-biblioref">13</a></sup></span></p>
<p>Selection bias - “Any comparison plagued by systematic differences between groups other than the differences we’re focused on”<span class="citation" data-cites="marginal_revolution_university_selection_2019"><sup><a href="#ref-marginal_revolution_university_selection_2019" role="doc-biblioref">12</a></sup></span></p>
<p>Omitted variables bias (OVB) - selection bias in a regression context<span class="citation" data-cites="marginal_revolution_university_selection_2019"><sup><a href="#ref-marginal_revolution_university_selection_2019" role="doc-biblioref">12</a></sup></span></p>
</section>
<section id="resources" class="level1">
<h1>Resources</h1>
<section id="textbooks" class="level2">
<h2 class="anchored" data-anchor-id="textbooks">Textbooks</h2>
<p><a href="https://www.r-causal.org/">Causal inference in R</a> - by Malcolm Barrett, Lucy D’Agostino McGowan, and Travis Gerke (14 March, 2024), from https://r-causal.github.io/r-causal-blog/about.html</p>
<p><a href="https://www.hsph.harvard.edu/miguel-hernan/wp-content/uploads/sites/1268/2024/01/hernanrobins_WhatIf_2jan24.pdf">Causal inference: What if?</a> - by Miguel Hernán and Jamie Robins [pdf, epidemiology focus]</p>
<p><a href="https://mixtape.scunning.com/">Causal inference: The Mixtape</a> - by Scott Cunningham [econometrics]</p>
<p><a href="https://theeffectbook.net/">The Effect</a> - by Nick Huntington-Klein [econometrics]</p>
<p><a href="https://www.worldbank.org/en/programs/sief-trust-fund/publication/impact-evaluation-in-practice">Impact evaluation in practice</a> - by Paul Gertler et al, World Bank Group, 2016</p>
<p>Methods Matter - by Richard Murnane and John Willett, 2010</p>
<p>Mastering Econometrics</p>
</section>
<section id="code-samples" class="level2">
<h2 class="anchored" data-anchor-id="code-samples">Code samples</h2>
<p><a href="https://lfbeisermcgrath.github.io/rimpactevaluation/">Impact evaluation in practice: Solutions for second edition in R</a></p>
<p><a href="https://remlapmot.github.io/cibookex-r/">R and stata code for exercises from Causal inference: What if?</a></p>
<p><a href="https://bookdown.org/aschmi11/causal_inf/">Causal inference in education</a> - by Anthony Schmidt</p>
<ul>
<li><p>R code associated with exercises from</p>
<ul>
<li><p>Methods Matter</p></li>
<li><p>Mostly Harmless</p></li>
<li><p>Impact Evaluation in Practice</p></li>
</ul></li>
</ul>
</section>
<section id="journal-articles" class="level2">
<h2 class="anchored" data-anchor-id="journal-articles">Journal articles</h2>
<p><a href="Causal%20inference%20on%20education%20policies:%20A%20survey%20of%20empirical%20studies%20using%20PISA,%20TIMSS%20and%20PIRLS">https://mpra.ub.uni-muenchen.de/76295/3/MPRA_paper_76295.pdf</a> - by Cordero et al, 2017</p>
</section>
<section id="blog-posts" class="level2">
<h2 class="anchored" data-anchor-id="blog-posts">Blog posts</h2>
<p><a href="https://emilyriederer.netlify.app/post/causal-design-patterns/">Causal design patterns for data analysts</a></p>
<p>Good overview of when you would use different techniques, and what they try to do (industry perspective)</p>
</section>
<section id="course-materials" class="level2">
<h2 class="anchored" data-anchor-id="course-materials">Course materials</h2>
<p><a href="https://evalsp24.classes.andrewheiss.com/">Program evaluation for public service</a> (Andrew Heiss, Georgia State University, Spring 2024)</p>
<ul>
<li><a href="https://evalsp23.classes.andrewheiss.com/">Spring 2023</a></li>
<li><a href="https://evalf22.classes.andrewheiss.com/">Fall 2002</a></li>
</ul>
<p><a href="https://www.masteringmetrics.com/online-metrics-resources/">Mastering ’Metrics</a></p>
<p><a href="https://www.youtube.com/playlist?list=PL-uRhZ_p-BM5ovNRg-G6hDib27OCvcyW8">Mastering econometrics with Joshua Angrist</a> [youtube]</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=iPBV3BlV7jk">Ceteris Paribus: Public vs.&nbsp;Private University</a></li>
<li><a href="https://www.youtube.com/watch?v=6YrIDhaUQOE">Selection bias: Will you make more going to a private university</a></li>
<li><a href="https://www.youtube.com/watch?v=eiffOVbYvNc&amp;list=PL-uRhZ_p-BM5ovNRg-G6hDib27OCvcyW8&amp;index=7">Introduction to differences-in-differences</a></li>
</ul>
<p><a href="https://clas.ucdenver.edu/marcelo-perraillon/sites/default/files/attached-files/week_3_causal_0.pdf">Health Services Research Methods I</a> (Marcelo Coca Perraillon, University of Colorado Denver)</p>
<p><a href="https://clas.ucdenver.edu/marcelo-perraillon/sites/default/files/attached-files/w2_causal_inference_perraillon.pdf" class="uri">https://clas.ucdenver.edu/marcelo-perraillon/sites/default/files/attached-files/w2_causal_inference_perraillon.pdf</a></p>
<p><a href="https://clas.ucdenver.edu/marcelo-perraillon/sites/default/files/attached-files/week_3_causal_0.pdf" class="uri">https://clas.ucdenver.edu/marcelo-perraillon/sites/default/files/attached-files/week_3_causal_0.pdf</a></p>
<p><a href="https://github.com/r-causal/causal_inference_r_workshop">Causal Inference in R Workshop</a></p>
<p><a href="https://www.youtube.com/watch?v=rBv39pK1iEs">Why propensity scores should not be used for matching</a> - Gary King [youtube]</p>
<p><a href="https://www.youtube.com/watch?v=tvMyjDi4dyg">Matching methods</a> - Gary King [youtube]</p>

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-line-spacing="2" role="list">
<div id="ref-huntington-klein_effect_2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Huntington-Klein, N. <em><a href="https://theeffectbook.net/">The <span>Effect</span>: <span>An</span> <span>Introduction</span> to <span>Research</span> <span>Design</span> and <span>Causality</span> <span></span> <span>The</span> <span>Effect</span></a></em>. (2021).</div>
</div>
<div id="ref-cunningham_causal_2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Cunningham, S. <em><a href="https://mixtape.scunning.com/">Causal <span>Inference</span>: <span>The</span> <span>Mixtape</span></a></em>. (2021).</div>
</div>
<div id="ref-heiss_program_nodate" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Heiss, A. <a href="https://evalsp24.classes.andrewheiss.com/example/matching-ipw.html">Program <span>Evaluation</span> - <span>Matching</span> and inverse probability weighting</a>. <em>Program Evaluation</em>.</div>
</div>
<div id="ref-murnane_methods_2010" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Murnane, R. J. &amp; Willett, J. B. <em>Methods <span>Matter</span>: <span>Improving</span> <span>Causal</span> <span>Inference</span> in <span>Educational</span> and <span>Social</span> <span>Science</span> <span>Research</span></em>. (Oxford University Press, Oxford New York, 2010).</div>
</div>
<div id="ref-ejdemyr_r_nodate" class="csl-entry" role="listitem">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Ejdemyr, S. <a href="https://simonejdemyr.com/r-tutorials/statistics/tutorial8.html">R <span>Tutorial</span> 8: <span>Propensity</span> <span>Score</span> <span>Matching</span></a>.</div>
</div>
<div id="ref-gertler_impact_2016" class="csl-entry" role="listitem">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">Gertler, P. J., Martinez, S., Premand, P., Rawlings, L. B. &amp; Vermeersch, C. M. J. <em>Impact <span>Evaluation</span> in <span>Practice</span></em>. (2016).</div>
</div>
<div id="ref-marginal_revolution_university_introduction_2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">7. </div><div class="csl-right-inline">Marginal Revolution University. <a href="https://www.youtube.com/watch?v=eiffOVbYvNc&amp;list=PL-uRhZ_p-BM5ovNRg-G6hDib27OCvcyW8&amp;index=7">Introduction to <span>Differences</span>-in-<span>Differences</span></a>. (2021).</div>
</div>
<div id="ref-dynarski_does_2003" class="csl-entry" role="listitem">
<div class="csl-left-margin">8. </div><div class="csl-right-inline">Dynarski, S. M. <a href="https://doi.org/10.1257/000282803321455287">Does <span>Aid</span> <span>Matter</span>? <span>Measuring</span> the <span>Effect</span> of <span>Student</span> <span>Aid</span> on <span>College</span> <span>Attendance</span> and <span>Completion</span></a>. <em>American Economic Review</em> <strong>93</strong>, 279–288 (2003).</div>
</div>
<div id="ref-king_why_2019" class="csl-entry" role="listitem">
<div class="csl-left-margin">9. </div><div class="csl-right-inline">King, G. &amp; Nielsen, R. Why <span>Propensity</span> <span>Scores</span> <span>Should</span> <span>Not</span> <span>Be</span> <span>Used</span> for <span>Matching</span>. <em>Political Analysis</em> <strong>27</strong>, 435–454 (2019).</div>
</div>
<div id="ref-methods_colloquium_gary_2015" class="csl-entry" role="listitem">
<div class="csl-left-margin">10. </div><div class="csl-right-inline">Methods Colloquium. <a href="https://www.youtube.com/watch?v=rBv39pK1iEs">Gary <span>King</span>, "<span>Why</span> <span>Propensity</span> <span>Scores</span> <span>Should</span> <span>Not</span> <span>Be</span> <span>Used</span> for <span>Matching</span>"</a>. (2015).</div>
</div>
<div id="ref-andrew_heiss_pmap_2020" class="csl-entry" role="listitem">
<div class="csl-left-margin">11. </div><div class="csl-right-inline">Andrew Heiss. <a href="https://www.youtube.com/watch?v=jECz-SS-sqc"><span>PMAP</span> 8521 • (7) <span>Randomization</span> and matching: (4) <span>Adjustment</span> with matching</a>. (2020).</div>
</div>
<div id="ref-marginal_revolution_university_selection_2019" class="csl-entry" role="listitem">
<div class="csl-left-margin">12. </div><div class="csl-right-inline">Marginal Revolution University. <a href="https://www.youtube.com/watch?v=6YrIDhaUQOE">Selection <span>Bias</span>: <span>Will</span> <span>You</span> <span>Make</span> <span>More</span> <span>Going</span> to a <span>Private</span> <span>University</span>?</a> (2019).</div>
</div>
<div id="ref-marginal_revolution_university_ceteris_2019" class="csl-entry" role="listitem">
<div class="csl-left-margin">13. </div><div class="csl-right-inline">Marginal Revolution University. <a href="https://www.youtube.com/watch?v=iPBV3BlV7jk">Ceteris <span>Paribus</span>: <span>Public</span> vs. <span>Private</span> <span>University</span></a>. (2019).</div>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>